
# Youtube video summarizer TG bot

Алгоритм работы бота:
- Извлекаются субтитры из youtube и очищаются от временных меток
- Субтитры отправляются в deepseek для пересказа содержимого

Для выгрузки субтитров используется утилита yt-dlp

Деплой необходимо выполнять на зарубежные сервера, чтобы иметь доступ к youtube

---

Алгоритм поиска контента для пересказа:
- запускается регулярный джоб, который ищет на популярных ресурсах статьи, сохраняет их таблицу contents
- сохраняет в таблицу processing_events событие на запуск конвейера обработки

Алогоритм работы конвейера:
- запускается регулярный job, который собирает события processing_events в не-терминальных состояниях
- передает события соответствующим обработчикам

---

### Init сервера

#### Регистрация нового пользователя

1. `ssh root@<ip>`
2. `groupadd panyukovnn`
3. `useradd -d /home/tech -m -s /bin/bash -g panyukovnn tech`
4. `passwd tech`
5. зайти на сервер под учетной записью tech
6. настраиваем ssh
7. из под root'а даём права на docker: `sudo usermod -aG docker tech`

#### Подготавливаем файлы

- бд развернута на том же сервере в docker-container, конфигруаия для подключения к бд хранится в /etc/common-config

1. Создаем docker-compose.yml, помещаем его в /deploy
2. Создаем файл config.yml с секретными конфигурациями для репозитория
3. Выполняем скрипт init-server.sh из папки /deploy 
4. Заходим на сервер 
5. Выполняем аутентификацию в Github Packages:

`echo YOUR_GITHUB_TOKEN | docker login ghcr.io -u YOUR_USERNAME --password-stdin`

где YOUR_GITHUB_TOKEN - pat с правами read:packages

### Deploy

1. Залить изменения в ветку main
2. Навесить тег
3. Дождаться уведомления в телеграм, об успешной сборке 
4. Запусить github workflow deploy-tag
